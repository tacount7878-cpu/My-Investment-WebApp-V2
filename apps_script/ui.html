<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>äº¤æ˜“ç´€éŒ„ V6.46</title>

<!-- å¼•å…¥ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- å¼•å…¥ Chart.js DataLabels æ“´å…… -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

<style>
:root{
  --bg0:#070b12; --bg1:#0b1220;
  --card:#0f1a2c; --txt:#e8eefc;
  --muted:#a9b6d6; --line:rgba(255,255,255,.08);
  --blue:#2f7bff; --blue2:#1a57c8;
  --red:#ff3b30; --green:#34c759; --shadow: 0 18px 60px rgba(0,0,0,.45);
  --radius:18px;
  --purple: #6e45e2; --purple2: #88d3ce;
}
*{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC",Arial;
  background:linear-gradient(180deg,var(--bg0),var(--bg1));
  color:var(--txt);
  padding:20px;
  min-height: 100vh;
  overflow-x: hidden;
}
.card{
  max-width:520px;
  margin:auto;
  background:rgba(255,255,255,.05);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:20px;
}
.title{font-size:22px;font-weight:900;margin-bottom:10px;}
.hint{color:var(--muted);font-size:14px;margin:6px 0;}
.bigInput{
  width:100%;height:60px;font-size:20px;font-weight:800;
  background:rgba(0,0,0,.25);color:white;
  border:1px solid var(--line);
  border-radius:14px;padding:0 14px;
}
.bigInput:focus{ border-color:var(--blue); outline:none; }

.chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;}
.chip{ padding:8px 12px;border-radius:999px; background:rgba(47,123,255,.15); border:1px solid rgba(47,123,255,.35); font-size:13px;font-weight:800; cursor:pointer; }

button.primary{ width:100%;height:60px; margin-top:16px; border-radius:16px; background:linear-gradient(180deg,var(--blue),var(--blue2)); border:none;color:white; font-size:18px;font-weight:900; cursor:pointer; }
.toast{ margin-top:12px;font-weight:800; text-align:center; }

.view { display: none; animation: fadeIn 0.3s ease; }
.view.active { display: block; }
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

.btn-group { display:flex; gap:10px; margin-bottom:16px; max-width:520px; margin-left:auto; margin-right:auto; }
button.secondary{ flex:1; height:50px; border-radius:14px; background:rgba(255,255,255,0.1); border:1px solid var(--line); color:white; font-size:15px; font-weight:800; cursor:pointer; transition:0.2s; }
button.action-btn { background:rgba(47,123,255,0.2); border-color:rgba(47,123,255,0.5); color:#8bb4ff;}

/* ğŸ¤– æµ®å‹•å•Ÿå‹•æŒ‰éˆ• - ç¢ºä¿ z-index è¶³å¤ é«˜ */
#ai-fab {
  position: fixed; bottom: 30px; right: 20px;
  width: 68px; height: 68px; border-radius: 50%;
  background: linear-gradient(135deg, var(--purple), var(--purple2));
  box-shadow: 0 10px 30px rgba(110, 69, 226, 0.6);
  display: flex; align-items: center; justify-content: center;
  font-size: 32px; cursor: pointer; z-index: 9999;
  transition: transform 0.2s, background 0.3s;
}
#ai-fab:active { transform: scale(0.9); }

/* ğŸ¤– æµ®å‹•å°è©±è¦–çª— */
#ai-window {
  position: fixed; top: 15%; left: 5%;
  width: 90%; max-width: 400px; height: 500px;
  background: rgba(22, 27, 34, 0.9);
  backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
  border-radius: 28px; border: 1px solid rgba(110, 69, 226, 0.4);
  box-shadow: 0 30px 80px rgba(0,0,0,0.7);
  z-index: 10000; display: none; flex-direction: column;
  overflow: hidden; touch-action: none;
}
#ai-header {
  padding: 16px 20px; background: rgba(110, 69, 226, 0.25);
  display: flex; justify-content: space-between; align-items: center;
  cursor: move; border-bottom: 1px solid rgba(255,255,255,0.1);
  position: relative;
}
.ai-title { font-weight: 900; color: #b392ff; display: flex; align-items: center; gap: 8px; font-size: 18px;}
.ai-drag-handle { width: 40px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; position: absolute; left: 50%; top: 6px; transform: translateX(-50%); }

#ai-chat-body { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 14px; scroll-behavior: smooth; }
.msg { max-width: 85%; padding: 12px 16px; border-radius: 20px; font-size: 15px; line-height: 1.6; position: relative; }
.msg-mimi { align-self: flex-start; background: rgba(255,255,255,0.1); color: #e8eefc; border-bottom-left-radius: 4px; }
.msg-user { align-self: flex-end; background: var(--purple); color: white; border-bottom-right-radius: 4px; }

#ai-footer { padding: 15px; display: flex; gap: 10px; border-top: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); }
#ai-input { flex: 1; background: rgba(255,255,255,0.08); border: 1px solid var(--line); border-radius: 14px; color: white; padding: 12px; outline: none; font-size: 16px;}
#ai-send { width: 48px; height: 48px; background: var(--purple); border: none; border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px;}

/* åœ–è¡¨å°ˆå±¬æ¨£å¼ */
.chart-card { background:rgba(0,0,0,0.2); border-radius:14px; padding:15px; margin-bottom:16px; border:1px solid var(--line);}
.chart-title { font-size:16px; font-weight:800; margin-bottom:12px; text-align:center; color:var(--txt);}
.chart-container{ position:relative; height:240px; width:100%; }

.calc-row { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; padding-bottom:12px; border-bottom:1px solid var(--line); }
.calc-label { font-size:15px; color:var(--muted); font-weight:700;}
.calc-value { font-size:18px; font-weight:900; color:white; }
.calc-input { width:140px; height:40px; font-size:18px; font-weight:800; text-align:right; background:rgba(0,0,0,0.4); border:1px solid var(--line); border-radius:8px; color:white; padding:0 10px;}

.final-networth { background: linear-gradient(135deg, rgba(52,199,89,0.15), rgba(52,199,89,0.05)); border: 1px solid rgba(52,199,89,0.4); border-radius: 16px; padding: 20px; text-align: center; margin-top: 20px; }
.final-val { color: #34c759; font-size: 36px; font-weight: 900; font-variant-numeric: tabular-nums; }

#loading-overlay-dash, #loading-overlay-net { font-size:14px; color:var(--muted); text-align:center; padding:40px 0; }
.update-indicator { font-size:12px; color:var(--green); text-align:center; margin-bottom:15px; font-weight:700; opacity:0; transition:opacity 0.3s;}
</style>
</head>

<body>

<!-- ğŸ¤– æµ®å‹•æŒ‰éˆ• (å§‹çµ‚åœ¨æœ€ä¸Šå±¤) -->
<div id="ai-fab" onclick="toggleAI()">ğŸ¤–</div>

<!-- ğŸ¤– æµ®å‹•å°è©±è¦–çª— -->
<div id="ai-window">
  <div id="ai-header">
    <div class="ai-drag-handle"></div>
    <div class="ai-title">ğŸ¤– å’ªå’ªæˆ°æƒ…åˆ†æ</div>
    <button style="background:none; border:none; color:white; font-size:24px; cursor:pointer;" onclick="toggleAI()">Ã—</button>
  </div>
  <div id="ai-chat-body">
    <div class="msg msg-mimi">ä¸»äººå¥½ï¼æˆ‘æ˜¯å’ªå’ªã€‚ä»Šå¤©éœ€è¦æˆ‘å¹«æ‚¨åˆ†æè³‡ç”¢ä½ˆå±€å—ï¼ŸğŸ˜Š</div>
  </div>
  <div id="ai-footer">
    <input type="text" id="ai-input" placeholder="å•å•é¡Œï¼Œä¾‹å¦‚ï¼šç›®å‰çš„æŒå€‰å¹³è¡¡å—ï¼Ÿ" onkeypress="if(event.keyCode==13) sendChat()">
    <button id="ai-send" onclick="sendChat()">â¤</button>
  </div>
</div>

<div id="env-tag" style="position:fixed; top:10px; right:10px; font-size:10px; opacity:0.3;">V6.46 Preview</div>

<!-- ================= è¦–åœ– 1ï¼šè¼¸å…¥è¡¨å–® ================= -->
<div id="view-input" class="view active">
  <div class="btn-group">
    <button class="secondary" onclick="switchView('dashboard')">ğŸ“Š æˆ°æƒ…åœ–è¡¨</button>
    <button class="secondary" onclick="switchView('networth')">ğŸ’° å³æ™‚ç¸½è³‡ç”¢</button>
  </div>

  <div class="card">
    <div class="title">äº¤æ˜“ç´€éŒ„</div>
    <div class="hint">æ¨™çš„åç¨±</div>
    <input id="name" class="bigInput" placeholder="ä¾‹å¦‚ï¼šå¯Œé‚¦å°50">
    <div class="hint">è‚¡ç¥¨ä»£è™Ÿ</div>
    <input id="symbol" class="bigInput" placeholder="ä¾‹å¦‚ï¼š006208.TW">
    <div class="chips">
      <div class="chip" onclick="quick('0050','0050.TW')">0050</div>
      <div class="chip" onclick="quick('2330','2330.TW')">2330</div>
      <div class="chip" onclick="quick('VT/VWRA','VT')">VT</div>
      <div class="chip" onclick="quick('Tesla','TSLA')">Tesla</div>
      <div class="chip" onclick="quick('Bitcoin','BTC-USD')">æ¯”ç‰¹å¹£</div>
    </div>
    <div class="hint">åƒ¹æ ¼</div>
    <input id="price" class="bigInput" type="number" step="any" inputmode="decimal">
    <div class="hint">è‚¡æ•¸</div>
    <input id="qty" class="bigInput" type="number" step="any" inputmode="decimal">
    <button class="primary" onclick="submitTrade()">é€å‡ºäº¤æ˜“</button>
    <div id="msg" class="toast"></div>
  </div>
</div>

<!-- ================= è¦–åœ– 2ï¼šåœ–è¡¨å„€è¡¨æ¿ ================= -->
<div id="view-dashboard" class="view">
  <div class="btn-group">
    <button class="secondary" onclick="switchView('input')">ğŸ”™ è¿”å›</button>
    <button class="secondary action-btn" onclick="refreshDashboard(false)">ğŸ”„ æ‰‹å‹•æ›´æ–°</button>
  </div>
  <div class="card">
    <div class="title">æˆ°æƒ…å„€è¡¨æ¿</div>
    <div id="update-msg-dash" class="update-indicator">âœ¨ æ•¸æ“šå·²æ›´æ–°</div>
    <div id="loading-overlay-dash">æ•¸æ“šè¼‰å…¥ä¸­...</div>
    <div id="dashboard-content" style="display:none;">
      <div class="chart-card"><div class="chart-title">è³‡ç”¢ç¸½æ·¨å€¼ (TWD)</div><div class="chart-container"><canvas id="historyChart"></canvas></div></div>
      <div class="chart-card"><div class="chart-title">æŒå€‰ä½”æ¯” (åˆä½µå¾Œ)</div><div class="chart-container"><canvas id="assetsChart"></canvas></div></div>
      <div class="chart-card"><div class="chart-title">æŠ•è³‡åœ°å€åˆ†ä½ˆ</div><div class="chart-container"><canvas id="regionsChart"></canvas></div></div>
    </div>
  </div>
</div>

<!-- ================= è¦–åœ– 3ï¼šå³æ™‚ç¸½è³‡ç”¢ ================= -->
<div id="view-networth" class="view">
  <div class="btn-group">
    <button class="secondary" onclick="switchView('input')">ğŸ”™ è¿”å›</button>
    <button class="secondary action-btn" onclick="refreshDashboard(false)">ğŸ”„ æ‰‹å‹•æ›´æ–°</button>
  </div>
  <div class="card">
    <div class="title">ğŸ’° å³æ™‚ç¸½è³‡ç”¢</div>
    <div id="update-msg-net" class="update-indicator">âœ¨ æ•¸æ“šå·²æ›´æ–°</div>
    <div id="loading-overlay-net">è¼‰å…¥ä¸­...</div>
    <div id="networth-content" style="display:none;">
      <div class="chart-card" style="border-color:rgba(47,123,255,0.3);">
        <div class="calc-row"><span>ğŸ“Š æŠ•è³‡éƒ¨ä½ç¸½å¸‚å€¼</span><span id="val-invest">0</span></div>
        <div class="calc-row"><span>ğŸ“ˆ å ±é…¬ç‡ (å·²å¯¦ç¾)</span><span id="val-return" style="color:var(--green);">0.00%</span></div>
        <div class="calc-row"><span>ğŸ’µ å·²å¯¦ç¾ç¸½æç›Š (TWD)</span><span id="val-realized-twd" style="color:var(--green);">0</span></div>
        <div class="calc-row" style="border:none;"><span>ğŸ’± å³æ™‚åŒ¯ç‡ (USD/TWD)</span><span id="val-usdrate">31.41</span></div>
      </div>
      <div class="hint">è¼¸å…¥ç›®å‰å¸³æˆ¶é¤˜é¡</div>
      <div class="calc-row"><span>å¸³æˆ¶ç¾é‡‘ (TWD)</span><input type="number" id="inp-cash-twd" class="calc-input" inputmode="decimal" oninput="calcTotalNetWorth()"></div>
      <div class="calc-row"><span>äº¤å‰²ä¸­ç¾é‡‘ (TWD)</span><input type="number" id="inp-settle-twd" class="calc-input" inputmode="decimal" oninput="calcTotalNetWorth()"></div>
      <div class="calc-row"><span>ç¾å…ƒç¾é‡‘ (USD)</span><input type="number" id="inp-cash-usd" class="calc-input" inputmode="decimal" oninput="calcTotalNetWorth()"></div>
      <div class="calc-row" style="border-color:rgba(255,59,48,0.3);"><span>è²¸æ¬¾é‡‘é¡ (TWD)</span><input type="number" id="inp-loan-twd" class="calc-input" inputmode="decimal" oninput="calcTotalNetWorth()" style="color:#ff6b6b;"></div>
      <div class="final-networth"><div class="final-label">è³‡ç”¢ç¸½æ·¨å€¼ (æ‰£é™¤è²¸æ¬¾)</div><div class="final-val" id="val-final-networth">0</div></div>
    </div>
  </div>
</div>

<script>
Chart.register(ChartDataLabels);
const isGasEnv = typeof google !== 'undefined' && google.script && google.script.run;

// æ¨¡æ“¬å™¨ (ç”¨æ–¼é è¦½æ¨¡å¼)
const scriptRun = isGasEnv ? google.script.run : (() => {
  const mock = {
    _cb: null,
    withSuccessHandler: function(cb) { this._cb = cb; return this; },
    withFailureHandler: function() { return this; },
    getDashboardData: function(i, m) {
      setTimeout(() => this._cb({
        history: [
          {date:'01/07', val:5358703}, {date:'01/16', val:5583811}, {date:'01/30', val:5283226}, {date:'02/09', val:5406319}, {date:'02/14', val:5698248}
        ],
        assets: [
          {name:'0050', value:2316000}, {name:'2330', value:381085}, {name:'å‚µå·(å°è‚¡)', value:1054130},
          {name:'VT/VWRA', value:2310949}, {name:'TSLA (ç‰¹æ–¯æ‹‰)', value:379346}, {name:'Google (Alphabet)', value:392013}, {name:'Bitcoin', value:232460}
        ],
        regions: [
          {name:'å°è‚¡', value:2697085}, {name:'ç¾è‚¡', value:780228}, {name:'å…¨çƒ', value:2310949}, {name:'åŠ å¯†', value:232460}, {name:'å‚µå·(å°è‚¡)', value:1054130}
        ],
        investTotal: 7074856, usdRate: 31.41, realizedReturn: 22.41, realizedReturnTwd: 250034
      }), 400);
    },
    callGeminiAnalysis: function(q, d) {
      setTimeout(() => this._cb("ä¸»äººå¥½ï¼æˆ‘å·²åˆ†æå®Œç•¢ã€‚ç›®å‰çš„ã€Œç¾è‚¡ã€è¡¨ç¾æ¶çœ¼ï¼Œã€ŒTSLAã€è¿‘æœŸè²¢ç»å·¨å¤§ï¼å»ºè­°å¯ä»¥ç¨å¾®èª¿æ•´ã€Œæ¯”ç‰¹å¹£ã€ä½”æ¯”ä¾†å¹³æ»‘é¢¨éšªã€‚ğŸš€"), 1000);
    },
    saveTrades: function() { setTimeout(() => this._cb({ok:true}), 500); }
  };
  return mock;
})();

let historyChart, assetsChart, regionsChart;
let cachedData = null;
let currentInvestTotal = 0;
let currentUsdRate = 31.41;

window.onload = () => {
  ['cash-twd','cash-usd','loan-twd','settle-twd'].forEach(id => {
    const el = document.getElementById('inp-'+id);
    if(el) { el.value = localStorage.getItem('wr_'+id.replace('-','_')) || ""; }
  });
  if(!document.getElementById('inp-cash-usd').value) document.getElementById('inp-cash-usd').value = "4170.99";
  if(!document.getElementById('inp-loan-twd').value) document.getElementById('inp-loan-twd').value = "1507627";
  calcTotalNetWorth();
  refreshDashboard(true);
  initDraggable();
};

function switchView(v) {
  document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
  document.getElementById('view-' + v).classList.add('active');
  if(v !== 'input') renderCharts();
}

function refreshDashboard(isSilent = false) {
  const loaders = ['dash','net'];
  const contentMap = { 'dash': 'dashboard-content', 'net': 'networth-content' };
  
  if(!isSilent) loaders.forEach(id => { 
    const overlay = document.getElementById('loading-overlay-'+id);
    const content = document.getElementById(contentMap[id]);
    if(overlay) overlay.style.display = 'block'; if(content) content.style.display = 'none'; 
  });

  const inputs = {
    cashTwd: document.getElementById('inp-cash-twd').value,
    settleTwd: document.getElementById('inp-settle-twd').value,
    cashUsd: document.getElementById('inp-cash-usd').value,
    loanTwd: document.getElementById('inp-loan-twd').value
  };
  
  scriptRun.withSuccessHandler(data => {
    cachedData = data;
    loaders.forEach(id => { 
      const overlay = document.getElementById('loading-overlay-'+id);
      const content = document.getElementById(contentMap[id]);
      if(overlay) overlay.style.display = 'none'; if(content) content.style.display = 'block'; 
    });
    currentInvestTotal = data.investTotal; currentUsdRate = data.usdRate;
    document.getElementById('val-invest').innerText = data.investTotal.toLocaleString();
    document.getElementById('val-usdrate').innerText = data.usdRate.toFixed(2);
    document.getElementById('val-return').innerText = (data.realizedReturn > 0 ? '+' : '') + data.realizedReturn.toFixed(2) + '%';
    document.getElementById('val-realized-twd').innerText = (data.realizedReturnTwd > 0 ? '+' : '') + data.realizedReturnTwd.toLocaleString();
    calcTotalNetWorth();
    if(!isSilent) showUpdateIndicator();
    renderCharts();
  }).getDashboardData(inputs, !isSilent);
}

function calcTotalNetWorth() {
  const t = Number(document.getElementById('inp-cash-twd')?.value || 0);
  const s = Number(document.getElementById('inp-settle-twd')?.value || 0);
  const u = Number(document.getElementById('inp-cash-usd')?.value || 0);
  const l = Number(document.getElementById('inp-loan-twd')?.value || 0);
  localStorage.setItem('wr_cash_twd', t); localStorage.setItem('wr_settle_twd', s); 
  localStorage.setItem('wr_cash_usd', u); localStorage.setItem('wr_loan_twd', l);
  const total = currentInvestTotal + t + s + (u * currentUsdRate) - l;
  const finalEl = document.getElementById('val-final-networth');
  if(finalEl) finalEl.innerText = Math.round(total).toLocaleString();
}

function showUpdateIndicator() {
  ['dash','net'].forEach(id => { const el = document.getElementById('update-msg-'+id); if(el) { el.style.opacity = 1; setTimeout(() => el.style.opacity = 0, 2000); } });
}

// --- ğŸ¤– å’ªå’ªå°è©±åŠŸèƒ½ ---
function toggleAI() {
  const win = document.getElementById('ai-window');
  win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
}

function sendChat() {
  const input = document.getElementById('ai-input');
  const text = input.value.trim();
  if(!text) return;
  appendMsg(text, 'user'); input.value = '';
  const loadingId = 'loading-' + Date.now();
  appendMsg('...', 'mimi', loadingId);

  scriptRun.withSuccessHandler(res => {
    const loader = document.getElementById(loadingId);
    if(loader) loader.innerText = res;
  }).callGeminiAnalysis(text, cachedData);
}

function appendMsg(text, type, id) {
  const body = document.getElementById('ai-chat-body');
  const div = document.createElement('div');
  div.className = 'msg msg-' + type;
  div.innerText = text;
  if(id) div.id = id;
  body.appendChild(div);
  body.scrollTop = body.scrollHeight;
}

// --- ğŸ¤ æ‹–å‹•åŠŸèƒ½ ---
function initDraggable() {
  const win = document.getElementById('ai-window');
  const header = document.getElementById('ai-header');
  let isDragging = false, startX, startY, winX, winY;
  const start = (e) => {
    if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') return;
    isDragging = true;
    const touch = e.type === 'touchstart' ? e.touches[0] : e;
    startX = touch.clientX; startY = touch.clientY;
    winX = win.offsetLeft; winY = win.offsetTop;
  };
  const move = (e) => {
    if (!isDragging) return;
    const touch = e.type === 'touchmove' ? e.touches[0] : e;
    win.style.left = (winX + touch.clientX - startX) + 'px';
    win.style.top = (winY + touch.clientY - startY) + 'px';
    win.style.right = 'auto'; win.style.bottom = 'auto';
  };
  const end = () => isDragging = false;
  header.addEventListener('mousedown', start); header.addEventListener('touchstart', start);
  window.addEventListener('mousemove', move); window.addEventListener('touchmove', move);
  window.addEventListener('mouseup', end); window.addEventListener('touchend', end);
}

// --- ğŸ“Š åœ–è¡¨ç¹ªè£½ ---
function renderCharts() {
  if(!cachedData) return;
  const ctxH = document.getElementById('historyChart')?.getContext('2d');
  if(ctxH){
    if(historyChart) historyChart.destroy();
    historyChart = new Chart(ctxH, { type: 'line', data: { labels: cachedData.history.map(d=>d.date), datasets:[{ label:'ç¸½æ·¨å€¼', data:cachedData.history.map(d=>d.val), borderColor:'#2f7bff', fill:true, backgroundColor:'rgba(47,123,255,0.1)', tension:0.4 }] }, options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false}, datalabels:{ display: false } }, scales:{ x:{ticks:{color:'#a9b6d6'}}, y:{ticks:{color:'#a9b6d6'}} } } });
  }
  const configPie = (ctx, data, colors) => {
    return new Chart(ctx, { type: 'doughnut', data: { labels: data.map(d=>d.name), datasets:[{ data: data.map(d=>d.value), backgroundColor: colors, borderWidth: 0 }] }, options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{position:'right',labels:{color:'#fff',boxWidth:12}}, datalabels:{ color:'#fff', font:{weight:'bold',size:10}, formatter:(v,c)=>{ let sum=0; c.dataset.data.forEach(x=>sum+=x); if((v*100/sum) < 4) return null; return (v*100/sum).toFixed(1)+'%'; } } } } });
  };
  const ctxA = document.getElementById('assetsChart')?.getContext('2d');
  if(ctxA){ if(assetsChart) assetsChart.destroy(); assetsChart = configPie(ctxA, cachedData.assets, ['#4285F4','#34A853','#FBBC05','#EA4335','#00BCD4','#8E24AA','#FF9800','#9E9E9E']); }
  const ctxR = document.getElementById('regionsChart')?.getContext('2d');
  if(ctxR){ if(regionsChart) regionsChart.destroy(); regionsChart = configPie(ctxR, cachedData.regions, ['#2f7bff','#34c759','#5856d6','#ff9500','#ff3b30']); }
}

function quick(n,s){ document.getElementById('name').value=n; document.getElementById('symbol').value=s; }
function submitTrade(){ alert("â³ äº¤æ˜“å¯«å…¥åŠŸèƒ½éœ€é€£å‹• Code.gs"); }
</script>
</body>
</html>